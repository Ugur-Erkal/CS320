<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base :: layout(~{::body})}">
<body>

<h2>Discount Management</h2>

<div class="card" th:if="${error}">
    <p style="margin:0;" th:text="${error}">Error</p>
</div>


<div class="card">
    <p style="margin:0;">
        Restaurant ID: <b th:text="${restaurantId}">1</b>
    </p>
</div>

<div class="card" th:if="${error != null}">
    <p style="margin:0;" th:text="${error}">Error</p>
</div>

<div class="card">
    <h3>Apply Discount</h3>

    <form method="post" action="/manager/discounts/apply">
        <input type="hidden" name="restaurantId" th:value="${restaurantId}"/>

        <div style="display:flex; gap:12px; flex-wrap:wrap;">
            <div>
                <label>Menu Item</label><br/>
                <select name="menuItemId" required>
                    <option th:each="mi : ${menuItems}"
                            th:value="${mi.menuItemId}"
                            th:text="${mi.name}">
                    </option>
                </select>
            </div>

            <div>
                <label>Discount (%)</label><br/>
                <input type="number" name="discountPercent" min="1" max="99" step="0.01" required/>
            </div>

            <div>
                <label>Start</label><br/>
                <input type="datetime-local" name="start" required/>
            </div>

            <div>
                <label>End</label><br/>
                <input type="datetime-local" name="end" required/>
            </div>
        </div>

        <div style="margin-top:12px;">
            <button class="btn btn-primary" type="submit">Apply</button>

            <!-- FIXED: back to dashboard -->
            <a class="btn" th:href="@{/dashboard(restaurantId=${restaurantId})}">Back</a>
        </div>
    </form>
</div>

<div class="card">
    <h3>Existing Discounts</h3>

    <p th:if="${discounts == null || discounts.isEmpty()}" style="margin:0;">No discounts found.</p>

    <table th:if="${discounts != null && !discounts.isEmpty()}"
           style="width:100%; border-collapse:collapse;">
        <thead>
        <tr>
            <th style="text-align:left; border-bottom:1px solid #eee; padding:6px;">Item</th>
            <th style="text-align:right; border-bottom:1px solid #eee; padding:6px;">Discount</th>
            <th style="text-align:left; border-bottom:1px solid #eee; padding:6px;">Start</th>
            <th style="text-align:left; border-bottom:1px solid #eee; padding:6px;">End</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="d : ${discounts}">
            <td style="padding:6px;" th:text="${d.menuItemName}">Pizza</td>
            <td style="padding:6px; text-align:right;">
                <span th:text="${d.discountPercent}">10</span>%
            </td>
            <td th:text="${#temporals.format(d.startDate, 'yyyy-MM-dd HH:mm')}">start</td>
            <td th:text="${#temporals.format(d.endDate, 'yyyy-MM-dd HH:mm')}">end</td>
        </tbody>
    </table>
</div>

</body>
</html>


